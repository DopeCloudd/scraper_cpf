generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model TrainingCenter {
  id                  Int        @id @default(autoincrement())
  externalId          String?    @unique
  name                String
  normalizedName      String      @default("")
  siren              String?
  siret              String?
  declaredTrainees   Int?
  delegatedTrainees  Int?
  declaredTrainers   Int?
  fiscalYearStart    DateTime?
  openDataUpdatedAt  DateTime?
  openDataPayload    Json?
  address             String?    @db.Text
  city                String?    @db.VarChar(512)
  postalCode          String?    @db.VarChar(32)
  region              String?    @db.VarChar(512)
  country             String?    @db.VarChar(32) @default("FR")
  latitude            Float?
  longitude           Float?
  email               String?
  phone               String?
  website             String? @db.VarChar(255)
  contactUrl          String?
  notes               String?
  lastListScrapedAt   DateTime?
  lastDetailScrapedAt DateTime?
  createdAt           DateTime   @default(now())
  updatedAt           DateTime   @updatedAt
  trainings           Training[]

  @@index([name])
  @@index([normalizedName])
  @@index([siren])
  @@index([city])
}

model Training {
  id                  Int              @id @default(autoincrement())
  centerId            Int
  center              TrainingCenter   @relation(fields: [centerId], references: [id])
  externalId          String?          @unique
  title               String
  detailUrl           String           @unique
  summary             String?
  descriptionHtml     String?         @db.LongText
  address             String?         @db.Text
  city                String?         @db.VarChar(512)
  postalCode          String?         @db.VarChar(32)
  region              String?         @db.VarChar(512)
  country             String?         @db.VarChar(32)
  modality            String?
  certification       String?
  locationText        String?
  priceText           String?
  priceValue          Decimal?         @db.Decimal(10, 2)
  durationText        String?
  durationHours       Int?
  startDate           DateTime?
  endDate             DateTime?
  searchQuery         String?
  needsDetail         Boolean          @default(true)
  listPageData        Json?
  detailPageData      Json?
  lastListScrapedAt   DateTime?
  lastDetailScrapedAt DateTime?
  createdAt           DateTime         @default(now())
  updatedAt           DateTime         @updatedAt

  @@index([centerId])
  @@index([needsDetail])
  @@index([lastDetailScrapedAt])
}
